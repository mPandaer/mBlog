---
title: MySQL  表的设计
slug: design-of-mysql-table-lmf4m
url: /post/design-of-mysql-table-lmf4m.html
date: '2024-06-06 14:22:24+08:00'
lastmod: '2024-06-06 15:22:31+08:00'
toc: true
isCJKLanguage: true
---

# MySQL  表的设计

​![image](https://raw.githubusercontent.com/mPandaer/mBlog/master/content/images/image-20240606152219-m0aoa1x.png)​

今天我要分享的是MySQL中表的设计，我会从四个方面来分享一下表应该如何设计，以及我在设计表的时候遇到的一些坑。首先我们从表的基本组成开始，即字段开始，讨论字段应该如何设计，然后会讨论表的结构设计，比如主键以及索引，然后会讨论一下表的访问设计，是SQL语句访问，还是NoSQL访问呢？最后就是物理存储的设计，是否使用表的压缩功能呢？

## 表的字段设计

字段无非就两个属性 一个是字段名，一个是字段类型，字段名按照规范来就好了，那么字段类型就是我们需要重点讨论的地方了，我们常用的字段类型，我认为只有三类，一类是**数字类型**，一类是**字符串类型**，另一类是**日期类型**。接下来我们一一讨论一下，这些类型的一些注意事项和重点。

### 数字类型

数字类型无非可以分为三类，一类是整型，一类是浮点类型，一类是定点类型，他们都有各自的应用场景，比如整型除了用于表示数量外，还可以被用于表示ID，由于浮点类型的计算精度问题用的并不会很多，相对而言，用的多的反而会是定点类型，也就是`Decimal(8,2)`​因为定点数不会有计算精度的问题，所以常常被用于表示价格这类的精度要求比较高的数据。但是这里我想说的是，我们可以利用整型来代替定点数，为什么这样说呢？在大多数的场景下，价格我们一般都会精确到分，如果我们用整型来表示价格，那么我们就可以将价格的单位从元改成分，这样有两个好处，第一 `Decimal`​类型是一个变长字段，远没有定长字段的读写效率高，第二 `Decimal`​的加减乘除的计算效率也没有整型的效率高。所以如果你的场景对性能有高要求，我比较推荐你将定点数改为整型。

### 字符串类型

字符串类型常见的有三类 `char`​,`varchar`​,`text`​, 其中`char`​，`varchar`​都可以指定**字符**个数切记是字符个数，而不是字节个数，而且两者的字符数限制不同，`char`​最大设置255个，而    `varchar`​ 最大设置65535个。所以对于一般的表设计，varchar足够我们用了，但是如果还不够我们用的话，可以尝试`text`​类型，字符串的限制除了和类型有关，还与**字符集**有关，目前我们常用的字符集是`utf8mb4`​ 因为这个字符集包含了emoji表情，所以这是目前我们主流的字符集。字符串除了类型比较重要，还有一个东西也很重要，那就是**排序规则**，一般而言，如果没有特别的需求，字符串都是不敏感大小写，除非你知道你的业务中要求敏感大小写。稍微总结一下，字符串类型的字段，我们的关注点有三个，一个是**具体的字符串类型**，一个是**字符集**的选择，一个是**排序规则**的选择。这三个很重要。一般字符串类型的字段多用于名字，描述以及密码，对于密码的设计，我这里提供一下我的设计思路：动态盐 + 动态加密算法，比如像这样 `$salt$alg_version$value`​ 我们可以通过$分割动态盐值，动态的加密算法，以及加密后的密码值。这样设计的好处是，如果盐值和加密算法都被泄露出去，也可以通过升级加密算法补救。有时候，我们在设计一些有限的状态字段时，会通过INT类型来设计，但是这样设计有两个不好的点，第一 意义不够明确，第二，容易出现脏值，比如状态字段只有1,2,3，但是可以无限制的插入其他值。这个时候，我们可以尝试用字符串来替代INT类型，来设计状态值，我们可以利用MySQL 8.0提供的check约束，来限制状态的值。

### 日期类型

MySQL中提供的日期类型，常用的有三个 `Date`​，`DateTime`​，`TimeStamp`​ 一般我们设计时间字段都精确到了秒，所以我们最常用的当属后面两个`DateTime`​，`TimeStamp`​一个占8字节，一个占4个字节，但是我强烈建议你使用`DateTime`​类型，因为由于`TimeStamp`​的设计原因，导致它能表示的最大日期（2038）离我们目前的时间（2024）不远了。最后在MySQL8.0中，提供了支持精确到毫秒，比如`DateTime(3)`​ `TimeStamp(3)`​ 保留三位毫秒数，不过这个时候所占据的空间会发生一些变化，`DateTime`​不变，`TimeStamp`​变为7个字节。由此可见，使用DateTime并不会占用太大的内存，而且还没有类似千年虫的问题。日期类型除了类型的选择，还有**时区**的选择，默认是系统时区，当然也可以通过修改配置，更换时区。一般我们使用日期类型，除了业务需要，多用于非业务需要，比如`update_time`​,`create_time`​ 这类字段，一般用于我们排错和记录日志使用。

‍

‍
